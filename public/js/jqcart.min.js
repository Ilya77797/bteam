/*
 jQuery jqCart Plugin v1.1.2
 requires jQuery v1.9 or later
 http://incode.pro/ update BTT
 Date: Date: 2016-05-18 19:15 update 2017-01-04
*/
(function(e){var c,g="",n=!1,l=e('<div class="jqcart-cart-label"><span class="jqcart-title">\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437</span><span class="jqcart-total-cnt">0</span></div>'),h={buttons:".add_item",cartLabel:"body",visibleLabel:!1,openByAdding:!1,handler:"/",currency:"\u20bd"},d={init:function(a){var b=0,f=0;h=e.extend(h,a);c=d.getStorage();if(null!==c&&Object.keys(c).length){for(var k in c)c.hasOwnProperty(k)&&(f=Math.ceil(c[k][1]*c[k][2]*100)/100,
b=Math.ceil(100*(b+f))/100);n=!0}l.prependTo(h.cartLabel)[n||h.visibleLabel?"show":"hide"]().on("click",d.openCart).find(".jqcart-total-cnt").text(b+" "+h.currency);e(document).on("click",h.buttons,d.addToCart).on("click",".jqcart-layout",function(a){a.target===this&&d.hideCart()}).on("click",".jqcart-incr",d.changeAmount).on("input keypress",".item_count",d.calcSum).on("input keyup",".jqcart-amount",d.changeAmount).on("click",".jqcart-del-item",d.delFromCart).on("submit",".jqcart-orderform",d.sendOrder).on("reset",
".jqcart-orderform",d.hideCart).on("click",".jqcart-clear-order",d.clearCart).on("click",".jqcart-print-order",d.printOrder);return!1},calcSum:function(){var a,b=e(this).closest(".item_box");a=+b.find(".item_price").text();var c=+b.find(".item_count").val();0<c?(b.children("td").children(".add_item").prop("disabled",!1).removeClass("no").addClass("yes"),a=Math.ceil(a*c*100)/100,b.find(".item_sum").text(a+" "+h.currency)):(b.find(".item_count").val(""),b.find(".item_sum").text(""),b.children("td").children(".add_item").prop("disabled",
!0).removeClass("yes").addClass("no"))},addToCart:function(a){a.preventDefault();c=d.getStorage()||{};a=e(this).closest(".item_box");var b=a.find(".item_id").text(),f=a.find(".item_title").text(),k=+a.find(".item_price").text(),g=+a.find(".item_count").val();c.hasOwnProperty(b)?c[b][2]+=g:c[b]=[f,k,g];a.find(".item_count").val(c[b][2]);a.find(".add_item").text("\u0417\u0430\u043a\u0430\u0437\u0430\u043d\u043e");d.setStorage(c);d.changeTotalCnt(1);l.show();h.openByAdding&&d.openCart();return!1},delFromCart:function(){var a=
e(this),a=a.closest(".jqcart-tr"),b=a.data("id");c=d.getStorage();delete c[b];d.setStorage(c);a.remove();d.recalcSum();a=e("#btt").DataTable().cells(function(a,c,e){return c==b?!0:!1}).nodes();a=e(a).closest(".item_box");a.find(".item_count").val("");a.find(".item_sum").text("");a.find(".add_item").text("\u0417\u0430\u043a\u0430\u0437\u0430\u0442\u044c").prop("disabled",!0).removeClass("yes").addClass("no");return!1},changeAmount:function(){var a=e(this),b=a.hasClass("jqcart-amount"),f=+(b?a.val():
a.data("incr")),k=a.closest(".jqcart-tr").data("id");c=d.getStorage();c[k][2]=b?isNaN(f)||1>f?0:f:c[k][2]+f;b?a.val(c[k][2]):a.siblings("input").val(c[k][2]);0>=c[k][2]?(delete c[k],d.setStorage(c),a.closest(".jqcart-tr").remove(),a=e("#btt").DataTable(),a=a.cells(function(a,b,c){return b==k?!0:!1}).nodes(),a=e(a).closest(".item_box"),a.find(".item_count").val(""),a.find(".item_sum").text(""),a.find(".add_item").text("\u0417\u0430\u043a\u0430\u0437\u0430\u0442\u044c").prop("disabled",!0).removeClass("yes").addClass("no")):
(d.setStorage(c),a=a.closest(".jqcart-tr"),b=+a.children(".jqcart-price").text(),f=c[k][2],b=Math.ceil(f*b*100)/100,a.children(".jqcart-sum").text(b),a=e("#btt").DataTable(),a=a.cells(function(a,b,c){return b==k?!0:!1}).nodes(),a=e(a).closest(".item_box"),a.find(".item_count").val(f),b=+a.find(".item_price").text(),f=+a.find(".item_count").val(),b=Math.ceil(b*f*100)/100,a.find(".item_sum").text(b+" "+h.currency));d.recalcSum();return!1},recalcSum:function(){var a=0;e(".jqcart-tr").each(function(){var b=
+e(this).children(".jqcart-sum").text();a+=b});e(".jqcart-subtotal strong").text(a);d.changeTotalCnt();0>=a&&(d.hideCart(),h.visibleLabel||l.hide());return!1},changeTotalCnt:function(){var a=0,b;c=d.getStorage();if(null!==c)for(var f in c)b=Math.ceil(c[f][1]*c[f][2]*100)/100,a=Math.ceil(100*(a+b))/100;e(".jqcart-total-cnt").text(a+" "+h.currency);return!1},openCart:function(){var a=0,b;c=d.getStorage();if(null!==c){g='<p class="jqcart-cart-title">\u041a\u043e\u0440\u0437\u0438\u043d\u0430 <span class="jqcart-print-order" title="\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437"></span></p><div class="jqcart-table-wrapper"><div class="jqcart-manage-order"><div class="jqcart-thead"><div>ID</div><div>\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435</div><div>\u0426\u0435\u043d\u0430</div><div>\u041a\u043e\u043b-\u0432\u043e</div><div>\u0421\u0443\u043c\u043c\u0430</div><div></div></div>';
for(var f in c)b=Math.ceil(c[f][1]*c[f][2]*100)/100,a=Math.ceil(100*(a+b))/100,g+='<div class="jqcart-tr" data-id="'+f+'">',g+='<div class="jqcart-small-td">'+f+"</div>",g+="<div>"+c[f][0]+"</div>",g+='<div class="jqcart-price">'+c[f][1]+"</div>",g+='<div><span class="jqcart-incr" data-incr="-1">\u2013</span><input type="text" class="jqcart-amount" value="'+c[f][2]+'"><span class="jqcart-incr" data-incr="1">+</span></div>',g+='<div class="jqcart-sum">'+b+"</div>",g+='<div class="jqcart-small-td"><span class="jqcart-del-item"></span></div></div>'}g+=
"</div><span>\u0412\u0430\u0448\u0430 \u043b\u0438\u0447\u043d\u0430\u044f \u0441\u043a\u0438\u0434\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u0443\u0447\u0442\u0435\u043d\u0430 \u043f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0437\u0430\u043a\u0430\u0437\u0430</span></div>";g+='<div class="jqcart-subtotal">\u0418\u0442\u043e\u0433\u043e: <strong>'+a+"</strong> "+h.currency+"</div>";g+='<script type="text/javascript">$(function($){$("#inputPhone").mask("+7 (999) 999 99 99");});\x3c/script>';
g+='<script src="/js/validate-form.js">\x3c/script>';a=a?g+'<p class="jqcart-cart-title">\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f:</p><form id="jqcart-orderform" class="jqcart-orderform"><p><label>\u0424\u0418\u041e:</label><input id="inputName" type="text" name="inputName"></p><p><label>\u0422\u0435\u043b\u0435\u0444\u043e\u043d:</label><input type="tel" name="inputPhone" id="inputPhone" class="mask" required></p><p><label>Email:</label><input id="inputMail" type="email" name="inputMail"><label class="jqcart-error"></label></p><p><label>\u041a\u043e\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439:</label><textarea id="inputMessage" name="inputMessage" class="inputMessage"></textarea></p><p></input><input type="submit" value="\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437"><input type="reset" value="\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043f\u043e\u043a\u0443\u043f\u043a\u0430\u043c"><input type="button" class="jqcart-clear-order" value="\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443"></input></p></form>':
'<h2 class="jqcart-empty-cart">\u041a\u043e\u0440\u0437\u0438\u043d\u0430 \u043f\u0443\u0441\u0442\u0430</h2>';e('<div class="jqcart-layout"><div class="jqcart-checkout"></div></div>').appendTo("body").find(".jqcart-checkout").html(a)},hideCart:function(){e(".jqcart-layout").fadeOut("fast",function(){e(this).remove()});return!1},sendOrder:function(a){a.preventDefault();a=e(this);e.ajax({url:"/handler.php",type:"POST",dataType:"json",data:{orderlist:e.param(d.getStorage()),userdata:a.serialize()},
success:function(a){"success"==a.errorText?(e('<div class="jqcart-layout"><div class="jqcart-checkout"></div></div>').appendTo("body").find(".jqcart-checkout").html('<h2 class="jqcart-empty-cart">'+a.message+"</h2>"),a.errors||setTimeout(m.clearCart,2E3)):(e(".jqcart-orderform").find(".jqcart-error").append("\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b."),
setTimeout(function(){e(".jqcart-error").hide()},4E3))},error:function(a){e('<div class="jqcart-layout"><div class="jqcart-checkout"></div></div>').appendTo("body").find(".jqcart-checkout").html('<h2 class="jqcart-empty-cart">\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u043e\u0437\u0436\u0435.</h2>');setTimeout(function(){e(".jqcart-layout").hide()},
2E3)}})},printOrder:function(){var a=e(this).closest(".jqcart-checkout").prop("outerHTML");if(!a)return!1;var b=window.open("","\u041f\u0435\u0447\u0430\u0442\u044c \u0437\u0430\u043a\u0430\u0437\u0430","width="+screen.width+",height="+screen.height),c=e(b.opener.document).find('link[href$="jqcart.min.css"]').attr("href"),d=new Date,d=("0"+d.getDate()).slice(-2)+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+d.getFullYear()+" "+("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+d.getSeconds()).slice(-2);
b.document.write("<html><head><title>\u0417\u0430\u043a\u0430\u0437 "+d+"</title>");b.document.write('<link rel="stylesheet" href="'+c+'" type="text/css" />');b.document.write("</head><body>");b.document.write(a);b.document.write("</body></html>");b.document.close();b.focus();b.print();b.close();return!0},clearCart:function(){localStorage.removeItem("jqcart");l[h.visibleLabel?"show":"hide"]().find(".jqcart-total-cnt").text(0);d.hideCart();/* e("#btt").DataTable().ajax.reload() */$("#clear-category").trigger('click');},setStorage:function(a){localStorage.setItem("jqcart",
JSON.stringify(a));return!1},getStorage:function(){return JSON.parse(localStorage.getItem("jqcart"))}},m={clearCart:function(){localStorage.removeItem("jqcart");l[h.visibleLabel?"show":"hide"]().find(".jqcart-total-cnt").text("0 "+h.currency);d.hideCart();e("#btt").DataTable().ajax.reload()},openCart:d.openCart,printOrder:d.printOrder};e.jqCart=function(a){if(m[a])return m[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)e.error('\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "'+
a+'" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!');else return d.init.apply(this,arguments)}})(jQuery);